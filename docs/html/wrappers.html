

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>partialwrap.wrappers &#8212; partialwrap</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=ac02cc09edc035673794" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=ac02cc09edc035673794" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=ac02cc09edc035673794" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/css/custom.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=ac02cc09edc035673794" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=ac02cc09edc035673794"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'wrappers';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="partialwrap.std_io" href="std_io.html" />
    <link rel="prev" title="Public API" href="api.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="contents.html">
  
  
  
  
  
    <p class="title logo__title">partialwrap</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="index.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="userguide.html">User Guide</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="api.html">Public API</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">partialwrap.wrappers</a></li>
<li class="toctree-l2"><a class="reference internal" href="std_io.html">partialwrap.std_io</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Authors</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/mcuntz/partialwrap" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/mcuntz/partialwrap/edit/main/docs/wrappers.rst" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/mcuntz/partialwrap/issues/new?title=Issue%20on%20page%20%2Fwrappers.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/wrappers.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>partialwrap.wrappers</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#partialwrap.wrappers.exe_mask_wrapper"><code class="docutils literal notranslate"><span class="pre">exe_mask_wrapper()</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#partialwrap.wrappers.exe_wrapper"><code class="docutils literal notranslate"><span class="pre">exe_wrapper()</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#partialwrap.wrappers.function_mask_wrapper"><code class="docutils literal notranslate"><span class="pre">function_mask_wrapper()</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#partialwrap.wrappers.function_wrapper"><code class="docutils literal notranslate"><span class="pre">function_wrapper()</span></code></a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="module-partialwrap.wrappers">
<span id="partialwrap-wrappers"></span><h1>partialwrap.wrappers<a class="headerlink" href="#module-partialwrap.wrappers" title="Permalink to this heading">#</a></h1>
<p>Wrappers to partialize functions so that they can simply be called as func(x).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">exe_wrapper</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span>
                  <span class="n">parameterfile</span><span class="p">,</span> <span class="n">parameterwriter</span><span class="p">,</span>
                  <span class="n">outputfile</span><span class="p">,</span> <span class="n">outputreader</span><span class="p">,</span>
                  <span class="p">{</span><span class="s1">&#39;shell&#39;</span><span class="p">:</span><span class="nb">bool</span><span class="p">,</span> <span class="s1">&#39;debug&#39;</span><span class="p">:</span><span class="nb">bool</span><span class="p">,</span> <span class="s1">&#39;pid&#39;</span><span class="p">:</span><span class="nb">bool</span><span class="p">,</span>
                   <span class="s1">&#39;pargs&#39;</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="s1">&#39;pkwargs&#39;</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="s1">&#39;keepparameterfile&#39;</span><span class="p">:</span><span class="nb">bool</span><span class="p">,</span>
                   <span class="s1">&#39;oargs&#39;</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="s1">&#39;okwargs&#39;</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="s1">&#39;keepoutputfile&#39;</span><span class="p">:</span><span class="nb">bool</span><span class="p">})</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">function_wrapper</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">kwarg</span><span class="p">)</span>
<span class="n">fx</span> <span class="o">=</span> <span class="n">obj</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p><cite>func</cite> can hence be an external executable or a Python function using
<cite>exe_wrapper</cite> or <cite>function_wrapper</cite>, respectively. External executables
will be passed to <cite>subprocess.run(func)</cite>. Due to <cite>subprocess.run()</cite>, <cite>func</cite> is
thus a string (e.g. ‘./prog -arg’) if <cite>shell=True</cite> or a list
(e.g. [‘./prog’, ‘-arg’]) if <cite>shell=False</cite> (default). <cite>func</cite> without any
arguments, pipes, or similar can simply be strings in both cases
(e.g. ‘./prog’).</p>
<p>This module was written by Matthias Cuntz while at Institut National de
Recherche pour l’Agriculture, l’Alimentation et l’Environnement (INRAE), Nancy,
France.</p>
<p>Copyright (c) 2016-2023 Matthias Cuntz - mc (at) macu (dot) de</p>
<p>Released under the MIT License; see LICENSE file for details.</p>
<p>The following wrappers are provided:</p>
<table class="autosummary longtable table autosummary">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#partialwrap.wrappers.exe_wrapper" title="partialwrap.wrappers.exe_wrapper"><code class="xref py py-obj docutils literal notranslate"><span class="pre">exe_wrapper</span></code></a>(func, parameterfile, ...)</p></td>
<td><p>Wrapper function for external programs</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#partialwrap.wrappers.exe_mask_wrapper" title="partialwrap.wrappers.exe_mask_wrapper"><code class="xref py py-obj docutils literal notranslate"><span class="pre">exe_mask_wrapper</span></code></a>(func, x0, mask, ...)</p></td>
<td><p>Same as <cite>exe_wrapper</cite> incl./excl.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#partialwrap.wrappers.function_wrapper" title="partialwrap.wrappers.function_wrapper"><code class="xref py py-obj docutils literal notranslate"><span class="pre">function_wrapper</span></code></a>(func, arg, kwarg, x)</p></td>
<td><p>Wrapper for Python functions.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#partialwrap.wrappers.function_mask_wrapper" title="partialwrap.wrappers.function_mask_wrapper"><code class="xref py py-obj docutils literal notranslate"><span class="pre">function_mask_wrapper</span></code></a>(func, x0, mask, arg, ...)</p></td>
<td><p>Wrapper function for Python function using a mask.</p></td>
</tr>
</tbody>
</table>
<dl class="simple">
<dt>History</dt><dd><ul class="simple">
<li><p>Written Nov 2016 by Matthias Cuntz (mc (at) macu (dot) de)</p></li>
<li><p>Added x0 and mask to wrapper of external programs,
Jan 2018, Matthias Cuntz</p></li>
<li><p>Added that <cite>pid</cite> is passed to parameterwriter,
and check parameterwriter (getargspec) for number or args, Feb 2018,
Matthias Cuntz</p></li>
<li><p>Removed check of number of parameters of parameterwriter (getargspec) but
add separate wrappers for separate parmeterwriters with different number
or arguments, Feb 2018, Matthias Cuntz</p></li>
<li><p>Added <cite>plotfile</cite> and made docstring sphinx compatible option, Jan 2018,
Matthias Cuntz</p></li>
<li><p>Changed to Sphinx docstring and numpydoc, Nov 2019, Matthias Cuntz</p></li>
<li><p>Remove that <cite>exe_wrappers</cite> support also Python functions. User should use
function_wrappers, Nov 2019, Matthias Cuntz</p></li>
<li><p>Make one <cite>exe_wrapper</cite>, passing bounds, mask, etc. via kwarg dictionary
to parameterwriter; distinguish iterable and array_like parameter types,
Jan 2020, Matthias Cuntz</p></li>
<li><p>Replaced kwarg.pop mechanism because it removed the keywords from
subsequent function calls, Feb 2020, Matthias Cuntz</p></li>
<li><p>Change from ValueError to TypeError if function given to exe wrappers,
Feb 2020, Matthias Cuntz</p></li>
<li><p>Renamed func to function in calling names, objective to output, and
renamed module name to wrappers, May 2020, Matthias Cuntz</p></li>
<li><p>Add arguments for outputreader, its handling of pid, and the ability to
have multiple output files, Jun 2020, Matthias Cuntz</p></li>
<li><p>Correct removal of list of parameterfiles and/or outputfiles, Jun 2020,
Matthias Cuntz</p></li>
<li><p>Added ability to keep produced parameterfiles and outputfiles, Jun 2020,
Matthias Cuntz</p></li>
<li><p>Pass pid just before keyword arguments to parameterwriter and
outputreader, Jun 2020, Matthias Cuntz</p></li>
<li><p>Use <cite>exe_wrapper</cite> in <cite>exe_mask_wrapper</cite>, Jun 2020, Matthias Cuntz</p></li>
<li><p>Make flake8 compliant, Dec 2020, Matthias Cuntz</p></li>
<li><p>Pass exe and pid as list if not shell in exe_wrapper,
May 2021, Matthias Cuntz</p></li>
<li><p>Change to subprocess.run for Python &gt;= v3.5, Aug 2022, Matthias Cuntz</p></li>
<li><p>Added examples and reformatted docstrings, Aug 2022, Matthias Cuntz</p></li>
<li><p>Added error function as fallback option in case subprocess exits with
error code &gt; 0, Aug 2022, Matthias Cuntz</p></li>
</ul>
</dd>
</dl>
<dl class="py function">
<dt class="sig sig-object py" id="partialwrap.wrappers.exe_mask_wrapper">
<span class="sig-name descname"><span class="pre">exe_mask_wrapper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parameterfile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parameterwriter</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outputfile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outputreader</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kwarg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/partialwrap/wrappers.html#exe_mask_wrapper"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#partialwrap.wrappers.exe_mask_wrapper" title="Permalink to this definition">#</a></dt>
<dd><p>Same as <cite>exe_wrapper</cite> incl./excl. parameters with mask.</p>
<p>Makes the transformation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
<span class="n">xx</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
</pre></div>
</div>
<p>and calls <cite>exe_wrapper</cite> with <em>xx</em>.</p>
<p>See <cite>exe_wrapper</cite> for details.</p>
<p class="rubric">Examples</p>
<p>Imagine an external program <em>prog.exe</em> written in C or Fortan, for example,
that reads in two parameters from the file <em>params.txt</em> and writes its
results to a file <em>out.txt</em>. The parameters can be written with
<cite>standard_parameter_writer</cite> and read with <cite>standard_output_reader</cite>.</p>
<p>Then this external program can be wrapped as:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">partialwrap</span> <span class="kn">import</span> <span class="n">exe_wrapper</span><span class="p">,</span> <span class="n">standard_parameter_writer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">partialwrap</span> <span class="kn">import</span> <span class="n">standard_output_reader</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">exe</span> <span class="o">=</span> <span class="s1">&#39;prog.exe&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameterfile</span> <span class="o">=</span> <span class="s1">&#39;params.txt&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">outputfile</span> <span class="o">=</span> <span class="s1">&#39;out.txt&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">exewrap</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">exe_wrapper</span><span class="p">,</span> <span class="n">exe</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="n">parameterfile</span><span class="p">,</span> <span class="n">standard_parameter_writer</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="n">outputfile</span><span class="p">,</span> <span class="n">standard_output_reader</span><span class="p">,</span> <span class="p">{})</span>
</pre></div>
</div>
<p>And is run as:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">exewrap</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
</pre></div>
</div>
<p><em>res</em> then holds the output of <em>prog.exe</em>.</p>
<p>Or one can find the minimum of the function in <em>prog.exe</em> with the global
optimizer Differential Evolution (assuming here that <em>prog.exe</em> calculates
the Rastrigin function).</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">scipy.optimize</span> <span class="k">as</span> <span class="nn">opt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="mf">5.12</span><span class="p">,</span> <span class="mf">5.12</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">differential_evolution</span><span class="p">(</span><span class="n">exewrap</span><span class="p">,</span> <span class="n">bounds</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">x</span>
<span class="go">array([-7.32336275e-09,  6.00261842e-09])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">fun</span>
<span class="go">0.0</span>
</pre></div>
</div>
<p>If one wants to fix the second parameter during optimisation, for example
because the parameter is insensitive or one knows the parameter very well,
then this parameter can be excluded from the optimisation by using
<cite>exe_mask_wrapper</cite>, setting the mask to <em>False</em>, and providing <em>initial</em>
values of the parameters.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">partialwrap</span> <span class="kn">import</span> <span class="n">exe_mask_wrapper</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">exemwrap</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">exe_mask_wrapper</span><span class="p">,</span> <span class="n">exe</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span>
<span class="gp">... </span>                   <span class="n">parameterfile</span><span class="p">,</span> <span class="n">standard_parameter_writer</span><span class="p">,</span>
<span class="gp">... </span>                   <span class="n">outputfile</span><span class="p">,</span> <span class="n">standard_output_reader</span><span class="p">,</span> <span class="p">{})</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span> <span class="n">bb</span> <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">bb</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span> <span class="k">if</span> <span class="n">mask</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">differential_evolution</span><span class="p">(</span><span class="n">exemwrap</span><span class="p">,</span> <span class="n">bounds</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">x</span>
<span class="go">array([-7.32336275e-09])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">fun</span>
<span class="go">0.0</span>
</pre></div>
</div>
<p>The final output parameters are then:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">xout</span> <span class="o">=</span> <span class="n">x0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">xout</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">xout</span>
<span class="go">array([-7.32336275e-09,  0.00000000e+00])</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="partialwrap.wrappers.exe_wrapper">
<span class="sig-name descname"><span class="pre">exe_wrapper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parameterfile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parameterwriter</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outputfile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outputreader</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kwarg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/partialwrap/wrappers.html#exe_wrapper"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#partialwrap.wrappers.exe_wrapper" title="Permalink to this definition">#</a></dt>
<dd><p>Wrapper function for external programs</p>
<p>Uses a <em>parameterwriter</em> and <em>outputreader</em> with the interfaces:</p>
<p><code class="docutils literal notranslate"><span class="pre">parameterwriter(parameterfile,</span> <span class="pre">x,</span> <span class="pre">*pargs,</span> <span class="pre">**pkwargs)</span></code></p>
<p>and</p>
<p><code class="docutils literal notranslate"><span class="pre">outputreader(outputfile,</span> <span class="pre">*oargs,</span> <span class="pre">**okwargs)</span></code></p>
<p>or if <em>pid==True</em>:</p>
<p><code class="docutils literal notranslate"><span class="pre">parameterwriter(parameterfile,</span> <span class="pre">x,</span> <span class="pre">*pargs,</span> <span class="pre">pid=pid,</span> <span class="pre">**pkwargs)</span></code></p>
<p>and</p>
<p><code class="docutils literal notranslate"><span class="pre">outputreader(outputfile,</span> <span class="pre">*oargs,</span> <span class="pre">pid=pid,</span> <span class="pre">**okwargs)</span></code></p>
<p>Examples of <em>parameterwriter</em> with <em>pid==True</em> are
<a class="reference internal" href="std_io.html#partialwrap.std_io.standard_parameter_writer" title="partialwrap.std_io.standard_parameter_writer"><code class="xref any py py-func docutils literal notranslate"><span class="pre">standard_parameter_writer</span></code></a> and <a class="reference internal" href="std_io.html#partialwrap.std_io.sub_params_ja" title="partialwrap.std_io.sub_params_ja"><code class="xref any py py-func docutils literal notranslate"><span class="pre">sub_params_ja</span></code></a>.</p>
<p>An example of <em>outputreader</em> with or without <em>pid</em> is
<a class="reference internal" href="std_io.html#partialwrap.std_io.standard_output_reader" title="partialwrap.std_io.standard_output_reader"><code class="xref any py py-func docutils literal notranslate"><span class="pre">standard_output_reader</span></code></a>.</p>
<p>To be used with <a class="reference external" href="https://docs.python.org/3/library/functools.html#functools.partial" title="(in Python v3.12)"><code class="xref any docutils literal notranslate"><span class="pre">functools.partial</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">obj</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">exe_wrapper</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span>
              <span class="n">parameterfile</span><span class="p">,</span> <span class="n">parameterwriter</span><span class="p">,</span>
              <span class="n">outputfile</span><span class="p">,</span> <span class="n">outputreader</span><span class="p">,</span>
              <span class="p">{</span><span class="s1">&#39;shell&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="s1">&#39;debug&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="s1">&#39;pid&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
               <span class="s1">&#39;pargs&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="s1">&#39;pkwargs&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
               <span class="s1">&#39;keepparameterfile&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
               <span class="s1">&#39;oargs&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="s1">&#39;okwargs&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
               <span class="s1">&#39;keepoutputfile&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">})</span>
</pre></div>
</div>
<p>This allows then calling <em>obj</em> simply with the parameters <em>x</em>:
<code class="docutils literal notranslate"><span class="pre">fx</span> <span class="pre">=</span> <span class="pre">obj(x)</span></code></p>
<p>which translates to:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">parameterwriter</span><span class="p">(</span><span class="n">parameterfile</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">pargs</span><span class="p">,</span> <span class="o">**</span><span class="n">pkwargs</span><span class="p">)</span>
<span class="n">err</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">outputreader</span><span class="p">(</span><span class="n">outputfile</span><span class="p">,</span> <span class="o">*</span><span class="n">oargs</span><span class="p">,</span> <span class="o">**</span><span class="n">okwargs</span><span class="p">)</span>
</pre></div>
</div>
<p>or if <em>pid==True</em> to:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">parameterwriter</span><span class="p">(</span><span class="n">parameterfile</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">pargs</span><span class="p">,</span> <span class="n">pid</span><span class="o">=</span><span class="n">pid</span><span class="p">,</span> <span class="o">**</span><span class="n">pkwargs</span><span class="p">)</span>
<span class="n">err</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">outputreader</span><span class="p">(</span><span class="n">outputfile</span><span class="p">,</span> <span class="o">*</span><span class="n">oargs</span><span class="p">,</span> <span class="n">pid</span><span class="o">=</span><span class="n">pid</span><span class="p">,</span> <span class="o">**</span><span class="n">okwargs</span><span class="p">)</span>
</pre></div>
</div>
<p>Note if <em>pid==True</em>, it is assumed that <em>parameterwriter</em> produces
files in the form <cite>parameterfile + ‘.’ + processid</cite>,
which will be removed after the function call.
Also files in the form <cite>outputfile + ‘.’ + processid</cite>
will be removed automatically.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func</strong> (<em>string</em><em> or </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.12)"><em>list</em></a><em> of </em><em>strings</em>) – External program to launch by <a class="reference external" href="https://docs.python.org/3/library/subprocess.html#module-subprocess" title="(in Python v3.12)"><code class="xref any docutils literal notranslate"><span class="pre">subprocess</span></code></a></p></li>
<li><p><strong>parameterfile</strong> (<em>string</em><em> or </em><em>iterable</em>) – Filename(s) of parameter file(s)</p></li>
<li><p><strong>parameterwriter</strong> (<em>callable</em>) – <p>Python function writing the <em>parameterfile</em>, called as:</p>
<p><code class="docutils literal notranslate"><span class="pre">parameterwriter(parameterfile,</span> <span class="pre">x,</span> <span class="pre">*pargs,</span> <span class="pre">**pkwargs)</span></code></p>
<p>or if <em>pid==True</em> as:</p>
<p><code class="docutils literal notranslate"><span class="pre">parameterwriter(parameterfile,</span> <span class="pre">x,</span> <span class="pre">*pargs,</span> <span class="pre">pid=pid,</span> <span class="pre">**pkwargs)</span></code></p>
</p></li>
<li><p><strong>outputfile</strong> (<em>string</em><em> or </em><em>iterable</em>) – Filename(s) of file(s) with output values written by the external
executable <em>func</em></p></li>
<li><p><strong>outputreader</strong> (<em>callable</em>) – <p>Python function for reading and processing output value(s) from
<em>outputfile</em>, called as:</p>
<p><code class="docutils literal notranslate"><span class="pre">outputreader(ouputfile,</span> <span class="pre">x,</span> <span class="pre">*oargs,</span> <span class="pre">**okwargs)</span></code></p>
<p>or if <em>pid==True</em> as:</p>
<p><code class="docutils literal notranslate"><span class="pre">outputreader(ouputfile,</span> <span class="pre">x,</span> <span class="pre">*oargs,</span> <span class="pre">pid=pid,</span> <span class="pre">**okwargs)</span></code></p>
</p></li>
<li><p><strong>kwarg</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.12)"><em>dict</em></a>) – <p>Dictionary with keyword arguments for <cite>exe_wrapper</cite>. Possible
arguments are:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">shell</span></code> (bool)
If True, <a class="reference external" href="https://docs.python.org/3/library/subprocess.html#module-subprocess" title="(in Python v3.12)"><code class="xref any docutils literal notranslate"><span class="pre">subprocess</span></code></a> opens shell for external executable</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">debug</span></code> (bool)
If True, model output is displayed while executable is running</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pid</span></code> (bool)
If True, append ‘.RandomNumber’ to <em>parameterfile</em> and
<em>outputfile</em> for parallel calls of <em>func</em></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pargs</span></code> (iterable)
List of arguments of <cite>parameterwriter</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pkwargs</span></code> (dict)
Dictionary with keyword arguments of <cite>parameterwriter</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">keepparameterfile</span></code> (bool)
If True, <cite>parameterfile</cite> produced with <cite>parameterwriter</cite> will
not be deleted after function call.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">oargs</span></code> (iterable)
List of arguments of <cite>outputreader</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">okwargs</span></code> (dict)
Dictionary with keyword arguments of <cite>outputreader</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">keepoutputfile</span></code> (bool)
If True, <cite>outputfile</cite> produced by <cite>func</cite> will not be deleted
after function call.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">error</span></code> (function)
Function to call in case subprocess exists with error code &gt; 0. The
function should take one argument, which will be the random number if
<cite>pid=True</cite> or <em>None</em> otherwise. The return value will be used instead
of the result of <em>outputreader</em>.</p></li>
</ul>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Output value calculated by the external executable <em>func</em> or via
the <em>outputreader</em></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.12)">float</a></p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Imagine an external program <em>prog.exe</em> written in C or Fortan, for example,
that reads in two parameters from the file <em>params.txt</em> and writes its
results to a file <em>out.txt</em>. The parameters can be written with
<cite>standard_parameter_writer</cite> and read with <cite>standard_output_reader</cite>.</p>
<p>Then this external program can be wrapped as:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">partialwrap</span> <span class="kn">import</span> <span class="n">exe_wrapper</span><span class="p">,</span> <span class="n">standard_parameter_writer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">partialwrap</span> <span class="kn">import</span> <span class="n">standard_output_reader</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">exe</span> <span class="o">=</span> <span class="s1">&#39;prog.exe&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameterfile</span> <span class="o">=</span> <span class="s1">&#39;params.txt&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">outputfile</span> <span class="o">=</span> <span class="s1">&#39;out.txt&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">exewrap</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">exe_wrapper</span><span class="p">,</span> <span class="n">exe</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="n">parameterfile</span><span class="p">,</span> <span class="n">standard_parameter_writer</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="n">outputfile</span><span class="p">,</span> <span class="n">standard_output_reader</span><span class="p">,</span> <span class="p">{})</span>
</pre></div>
</div>
<p>And is run as:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">exewrap</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
</pre></div>
</div>
<p><em>res</em> then holds the output of <em>prog.exe</em>.</p>
<p>Or one can find the minimum of the function in <em>prog.exe</em> with the global
optimizer Differential Evolution (assuming here that <em>prog.exe</em> calculates
the Rastrigin function).</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">scipy.optimize</span> <span class="k">as</span> <span class="nn">opt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="mf">5.12</span><span class="p">,</span> <span class="mf">5.12</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">differential_evolution</span><span class="p">(</span><span class="n">exewrap</span><span class="p">,</span> <span class="n">bounds</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">x</span>
<span class="go">array([-7.32336275e-09,  6.00261842e-09])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">fun</span>
<span class="go">0.0</span>
</pre></div>
</div>
<p>If <em>prog.exe</em> might fail with some parameter combinations from the
Differential Evolution algorithm, then one can give a fallback function for
this cases that, for example, returns arbitrary large values.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">err</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="mf">10000.</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mf">10000.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">exewrap</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">exe_wrapper</span><span class="p">,</span> <span class="n">exe</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="n">parameterfile</span><span class="p">,</span> <span class="n">standard_parameter_writer</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="n">outputfile</span><span class="p">,</span> <span class="n">standard_output_reader</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="p">{</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="n">err</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">differential_evolution</span><span class="p">(</span><span class="n">exewrap</span><span class="p">,</span> <span class="n">bounds</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="partialwrap.wrappers.function_mask_wrapper">
<span class="sig-name descname"><span class="pre">function_mask_wrapper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">arg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kwarg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/partialwrap/wrappers.html#function_mask_wrapper"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#partialwrap.wrappers.function_mask_wrapper" title="Permalink to this definition">#</a></dt>
<dd><p>Wrapper function for Python function using a mask.</p>
<p>To be used with partial:</p>
<p><code class="docutils literal notranslate"><span class="pre">obj</span> <span class="pre">=</span> <span class="pre">partial(function_mask_wrapper,</span> <span class="pre">func,</span> <span class="pre">x0,</span> <span class="pre">mask,</span> <span class="pre">arg,</span> <span class="pre">kwarg)</span></code></p>
<p>This allows then calling obj with only the non-masked parameters:</p>
<p><code class="docutils literal notranslate"><span class="pre">fx</span> <span class="pre">=</span> <span class="pre">obj(x)</span></code></p>
<p>which translates to:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
<span class="n">xx</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
<span class="n">fx</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwarg</span><span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func</strong> (<em>callable</em>) – Python function to be called <cite>func(x, *arg, **kwarg)</cite></p></li>
<li><p><strong>x0</strong> (<em>array_like</em>) – Fixed values of masked parameters</p></li>
<li><p><strong>mask</strong> (<em>array_like</em>) – Mask to use <em>x0</em> values (<cite>mask[i]=1</cite>) or use new parameters
<em>x</em> (<cite>ask[i]=0</cite>) in call of the function</p></li>
<li><p><strong>arg</strong> (<em>iterable</em>) – Arguments passed to <em>func</em></p></li>
<li><p><strong>kwarg</strong> (<em>dictionary</em>) – Keyword arguments passed to <em>func</em></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Output value calculated by <em>func</em></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.12)">float</a></p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Having the Python function <em>rastrigin</em> with the parameter <em>a</em> and
the keyword argument <em>b</em>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">rastrigin</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
<p>We want to evaluate the 5-dimensional rastrigin function at
<cite>[-1, 0, 1, 2, 3]</cite> using the parameters <cite>a=20.</cite>, <cite>b=np.pi</cite>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">partialwrap</span> <span class="kn">import</span> <span class="n">function_wrapper</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">args</span>   <span class="o">=</span> <span class="p">[</span><span class="mf">20.</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mf">1.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rastra</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">function_wrapper</span><span class="p">,</span> <span class="n">rastrigin</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">rastra</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span>
<span class="go">135.0</span>
</pre></div>
</div>
<p>Or we want find its minimum with the global optimizer Differential
Evolution, which allows passing arguments such as <cite>args=(20.)</cite> but does not
allow passing keyword arguments such <cite>b=np.pi</cite>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">scipy.optimize</span> <span class="k">as</span> <span class="nn">opt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="mf">5.12</span><span class="p">,</span> <span class="mf">5.12</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">differential_evolution</span><span class="p">(</span><span class="n">rastra</span><span class="p">,</span> <span class="n">bounds</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">x</span>
<span class="go">array([-7.32336275e-09,  6.00261842e-09,  1.26476721e-09, -1.61965090e-10,</span>
<span class="go">       -7.35012009e-09])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">fun</span>
<span class="go">0.0</span>
</pre></div>
</div>
<p>If one wants to fix the second parameter during optimisation, for example
because the parameter is insensitive or one knows the parameter very well
(very hypothetical in the example of rastrigin), then this parameter can be
excluded from the optimisation by using <cite>function_mask_wrapper</cite>, setting
the mask to <em>False</em>, and providing <em>initial</em> values of the parameters.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">partialwrap</span> <span class="kn">import</span> <span class="n">function_mask_wrapper</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rastram</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">function_mask_wrapper</span><span class="p">,</span> <span class="n">rastrigin</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span> <span class="n">bb</span> <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">bb</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span> <span class="k">if</span> <span class="n">mask</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">differential_evolution</span><span class="p">(</span><span class="n">rastram</span><span class="p">,</span> <span class="n">bounds</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">x</span>
<span class="go">array([-7.32336275e-09,  1.26476721e-09, -1.61965090e-10, -7.35012009e-09])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">fun</span>
<span class="go">0.0</span>
</pre></div>
</div>
<p>The final output parameters are then:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">xout</span> <span class="o">=</span> <span class="n">x0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">xout</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">xout</span>
<span class="go">array([-7.32336275e-09,  0.00000000e+00,  1.26476721e-09, -1.61965090e-10,</span>
<span class="go">       -7.35012009e-09])</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="partialwrap.wrappers.function_wrapper">
<span class="sig-name descname"><span class="pre">function_wrapper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">arg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kwarg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/partialwrap/wrappers.html#function_wrapper"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#partialwrap.wrappers.function_wrapper" title="Permalink to this definition">#</a></dt>
<dd><p>Wrapper for Python functions.</p>
<p>To be used with partial:</p>
<p><code class="docutils literal notranslate"><span class="pre">obj</span> <span class="pre">=</span> <span class="pre">partial(function_wrapper,</span> <span class="pre">func,</span> <span class="pre">arg,</span> <span class="pre">kwarg)</span></code></p>
<p>This allows then calling obj with only the non-masked parameters:</p>
<p><code class="docutils literal notranslate"><span class="pre">fx</span> <span class="pre">=</span> <span class="pre">obj(x)</span></code></p>
<p>which translates to:</p>
<p><code class="docutils literal notranslate"><span class="pre">fx</span> <span class="pre">=</span> <span class="pre">func(x,</span> <span class="pre">*arg,</span> <span class="pre">**kwarg)</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func</strong> (<em>callable</em>) – Python function to be called <cite>func(x, *arg, **kwarg)</cite></p></li>
<li><p><strong>arg</strong> (<em>iterable</em>) – Arguments passed to <em>func</em></p></li>
<li><p><strong>kwarg</strong> (<em>dictionary</em>) – Keyword arguments passed to <em>func</em></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Output value calculated by <em>func</em></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.12)">float</a></p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Having the Python function <em>rastrigin</em> with the parameter <em>a</em> and
the keyword argument <em>b</em>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">rastrigin</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
<p>We want to evaluate the 5-dimensional rastrigin function at
<cite>[-1, 0, 1, 2, 3]</cite> using the parameters <cite>a=20.</cite>, <cite>b=np.pi</cite>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">partialwrap</span> <span class="kn">import</span> <span class="n">function_wrapper</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">args</span>   <span class="o">=</span> <span class="p">[</span><span class="mf">20.</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mf">1.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rastra</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">function_wrapper</span><span class="p">,</span> <span class="n">rastrigin</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">rastra</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span>
<span class="go">135.0</span>
</pre></div>
</div>
<p>Or find its minimum with the global optimizer Differential Evolution,
which allows passing arguments such as <cite>args=(20.)</cite> but does not allow
passing keyword arguments such <cite>b=np.pi</cite>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">scipy.optimize</span> <span class="k">as</span> <span class="nn">opt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="mf">5.12</span><span class="p">,</span> <span class="mf">5.12</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">differential_evolution</span><span class="p">(</span><span class="n">rastra</span><span class="p">,</span> <span class="n">bounds</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">x</span>
<span class="go">array([-7.32336275e-09,  6.00261842e-09,  1.26476721e-09, -1.61965090e-10,</span>
<span class="go">       -7.35012009e-09])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">fun</span>
<span class="go">0.0</span>
</pre></div>
</div>
</dd></dl>

</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="api.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Public API</p>
      </div>
    </a>
    <a class="right-next"
       href="std_io.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">partialwrap.std_io</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#partialwrap.wrappers.exe_mask_wrapper"><code class="docutils literal notranslate"><span class="pre">exe_mask_wrapper()</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#partialwrap.wrappers.exe_wrapper"><code class="docutils literal notranslate"><span class="pre">exe_wrapper()</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#partialwrap.wrappers.function_mask_wrapper"><code class="docutils literal notranslate"><span class="pre">function_mask_wrapper()</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#partialwrap.wrappers.function_wrapper"><code class="docutils literal notranslate"><span class="pre">function_wrapper()</span></code></a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Matthias Cuntz
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2016-2023, Matthias Cuntz.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=ac02cc09edc035673794"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=ac02cc09edc035673794"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>