<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>partialwrap.wrappers &#8212; partialwrap 1.7 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/custom.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="partialwrap.std_io" href="std_io.html" />
    <link rel="prev" title="Public API" href="api.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="module-partialwrap.wrappers">
<span id="partialwrap-wrappers"></span><h1>partialwrap.wrappers<a class="headerlink" href="#module-partialwrap.wrappers" title="Permalink to this heading">¶</a></h1>
<p>Wrappers to partialise functions so that they can be simply called as func(x).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="nb">list</span><span class="p">)):</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">exe_wrapper</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span>
                  <span class="n">parameterfile</span><span class="p">,</span> <span class="n">parameterwriter</span><span class="p">,</span> <span class="n">outputfile</span><span class="p">,</span> <span class="n">outputreader</span><span class="p">,</span>
                  <span class="p">{</span><span class="s1">&#39;shell&#39;</span><span class="p">:</span><span class="nb">bool</span><span class="p">,</span> <span class="s1">&#39;debug&#39;</span><span class="p">:</span><span class="nb">bool</span><span class="p">,</span> <span class="s1">&#39;pid&#39;</span><span class="p">:</span><span class="nb">bool</span><span class="p">,</span>
                   <span class="s1">&#39;pargs&#39;</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="s1">&#39;pkwargs&#39;</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="s1">&#39;keepparameterfile&#39;</span><span class="p">:</span><span class="nb">bool</span><span class="p">,</span>
                   <span class="s1">&#39;oargs&#39;</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="s1">&#39;okwargs&#39;</span><span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="s1">&#39;keepoutputfile&#39;</span><span class="p">:</span><span class="nb">bool</span><span class="p">})</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">function_wrapper</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">kwarg</span><span class="p">)</span>
<span class="n">fx</span> <span class="o">=</span> <span class="n">obj</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
<p><cite>func</cite> can be a Python function or external executable. External executables
will be passed to <cite>subprocess.run(func)</cite>. <cite>func</cite> can then be a string (e.g.
‘./prog -arg’) if <cite>shell=True</cite> or a list (e.g. [‘./prog’, ‘-arg’]) if
<cite>shell=False</cite> (default). Programs without arguments, pipes, etc. can simply be
strings with <cite>shell=True</cite> or <cite>False</cite>.</p>
<p>This module was written by Matthias Cuntz while at Institut National de
Recherche pour l’Agriculture, l’Alimentation et l’Environnement (INRAE), Nancy,
France.</p>
<p>Copyright (c) 2016-2022 Matthias Cuntz - mc (at) macu (dot) de</p>
<p>Released under the MIT License; see LICENSE file for details.</p>
<p>The following wrappers are provided:</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#partialwrap.wrappers.exe_wrapper" title="partialwrap.wrappers.exe_wrapper"><code class="xref py py-obj docutils literal notranslate"><span class="pre">exe_wrapper</span></code></a>(func, parameterfile, ...)</p></td>
<td><p>Wrapper function for external programs using a <em>parameterwriter</em> and <em>outputreader</em> with the interfaces: <code class="docutils literal notranslate"><span class="pre">parameterwriter(parameterfile,</span> <span class="pre">x,</span> <span class="pre">*pargs,</span> <span class="pre">**pkwargs)</span></code> and <code class="docutils literal notranslate"><span class="pre">outputreader(outputfile,</span> <span class="pre">*oargs,</span> <span class="pre">**okwargs)</span></code> or if <em>pid==True</em>: <code class="docutils literal notranslate"><span class="pre">parameterwriter(parameterfile,</span> <span class="pre">x,</span> <span class="pre">*pargs,</span> <span class="pre">pid=pid,</span> <span class="pre">**pkwargs)</span></code> and <code class="docutils literal notranslate"><span class="pre">outputreader(outputfile,</span> <span class="pre">*oargs,</span> <span class="pre">pid=pid,</span> <span class="pre">**okwargs)</span></code></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#partialwrap.wrappers.exe_mask_wrapper" title="partialwrap.wrappers.exe_mask_wrapper"><code class="xref py py-obj docutils literal notranslate"><span class="pre">exe_mask_wrapper</span></code></a>(func, x0, mask, ...)</p></td>
<td><p>Same as <cite>exe_wrapper</cite> incl./excl.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="#partialwrap.wrappers.function_wrapper" title="partialwrap.wrappers.function_wrapper"><code class="xref py py-obj docutils literal notranslate"><span class="pre">function_wrapper</span></code></a>(func, arg, kwarg, x)</p></td>
<td><p>Wrapper for Python functions.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#partialwrap.wrappers.function_mask_wrapper" title="partialwrap.wrappers.function_mask_wrapper"><code class="xref py py-obj docutils literal notranslate"><span class="pre">function_mask_wrapper</span></code></a>(func, x0, mask, arg, ...)</p></td>
<td><p>Wrapper function for Python function using a mask.</p></td>
</tr>
</tbody>
</table>
<dl class="simple">
<dt>History</dt><dd><ul class="simple">
<li><p>Written Nov 2016 by Matthias Cuntz (mc (at) macu (dot) de)</p></li>
<li><p>Added x0 and mask to wrapper of external programs,
Jan 2018, Matthias Cuntz</p></li>
<li><p>Added that <cite>pid</cite> is passed to parameterwriter,
and check parameterwriter (getargspec) for number or args, Feb 2018,
Matthias Cuntz</p></li>
<li><p>Removed check of number of parameters of parameterwriter (getargspec) but
add separate wrappers for separate parmeterwriters with different number
or arguments, Feb 2018, Matthias Cuntz</p></li>
<li><p>Added <cite>plotfile</cite> and made docstring sphinx compatible option, Jan 2018,
Matthias Cuntz</p></li>
<li><p>Changed to Sphinx docstring and numpydoc, Nov 2019, Matthias Cuntz</p></li>
<li><p>Remove that <cite>exe_wrappers</cite> support also Python functions. User should use
function_wrappers, Nov 2019, Matthias Cuntz</p></li>
<li><p>Make one <cite>exe_wrapper</cite>, passing bounds, mask, etc. via kwarg dictionary
to parameterwriter; distinguish iterable and array_like parameter types,
Jan 2020, Matthias Cuntz</p></li>
<li><p>Replaced kwarg.pop mechanism because it removed the keywords from
subsequent function calls, Feb 2020, Matthias Cuntz</p></li>
<li><p>Change from ValueError to TypeError if function given to exe wrappers,
Feb 2020, Matthias Cuntz</p></li>
<li><p>Renamed func to function in calling names, objective to output, and
renamed module name to wrappers, May 2020, Matthias Cuntz</p></li>
<li><p>Add arguments for outputreader, its handling of pid, and the ability to
have multiple output files, Jun 2020, Matthias Cuntz</p></li>
<li><p>Correct removal of list of parameterfiles and/or outputfiles, Jun 2020,
Matthias Cuntz</p></li>
<li><p>Added ability to keep produced parameterfiles and outputfiles, Jun 2020,
Matthias Cuntz</p></li>
<li><p>Pass pid just before keyword arguments to parameterwriter and
outputreader, Jun 2020, Matthias Cuntz</p></li>
<li><p>Use <cite>exe_wrapper</cite> in <cite>exe_mask_wrapper</cite>, Jun 2020, Matthias Cuntz</p></li>
<li><p>Make flake8 compliant, Dec 2020, Matthias Cuntz</p></li>
<li><p>Pass exe and pid as list if not shell in exe_wrapper,
May 2021, Matthias Cuntz</p></li>
<li><p>Change to subprocess.run for Python &gt;= v3.5, Aug 2022, Matthias Cuntz</p></li>
<li><p>Added examples and reformatted docstrings, Aug 2022, Matthias Cuntz</p></li>
<li><p>Added error function as fallback option in case subprocess exits with
error code &gt; 0, Aug 2022, Matthias Cuntz</p></li>
</ul>
</dd>
</dl>
<dl class="py function">
<dt class="sig sig-object py" id="partialwrap.wrappers.exe_mask_wrapper">
<span class="sig-name descname"><span class="pre">exe_mask_wrapper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parameterfile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parameterwriter</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outputfile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outputreader</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kwarg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/partialwrap/wrappers.html#exe_mask_wrapper"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#partialwrap.wrappers.exe_mask_wrapper" title="Permalink to this definition">¶</a></dt>
<dd><p>Same as <cite>exe_wrapper</cite> incl./excl. parameters with mask.</p>
<p>Makes the transformation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
<span class="n">xx</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
</pre></div>
</div>
<p>and calls <cite>exe_wrapper</cite> with <em>xx</em>.</p>
<p>See <cite>exe_wrapper</cite> for details.</p>
<p class="rubric">Examples</p>
<p>Imagine an external program <em>prog.exe</em> written in C or Fortan, for example,
that reads in two parameters from the file <em>params.txt</em> and writes its
results to a file <em>out.txt</em>. The parameters can be written with
<cite>standard_parameter_writer</cite> and read with <cite>standard_output_reader</cite>.</p>
<p>Then this external program can be wrapped as:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">partialwrap</span> <span class="kn">import</span> <span class="n">exe_wrapper</span><span class="p">,</span> <span class="n">standard_parameter_writer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">partialwrap</span> <span class="kn">import</span> <span class="n">standard_output_reader</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">exe</span> <span class="o">=</span> <span class="s1">&#39;prog.exe&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameterfile</span> <span class="o">=</span> <span class="s1">&#39;params.txt&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">outputfile</span> <span class="o">=</span> <span class="s1">&#39;out.txt&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">exewrap</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">exe_wrapper</span><span class="p">,</span> <span class="n">exe</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="n">parameterfile</span><span class="p">,</span> <span class="n">standard_parameter_writer</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="n">outputfile</span><span class="p">,</span> <span class="n">standard_output_reader</span><span class="p">,</span> <span class="p">{})</span>
</pre></div>
</div>
<p>And is run as:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">exewrap</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
</pre></div>
</div>
<p><em>res</em> then holds the output of <em>prog.exe</em>.</p>
<p>Or one can find the minimum of the function in <em>prog.exe</em> with the global
optimizer Differential Evolution (assuming here that <em>prog.exe</em> calculates
the Rastrigin function).</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">scipy.optimize</span> <span class="k">as</span> <span class="nn">opt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="mf">5.12</span><span class="p">,</span> <span class="mf">5.12</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">differential_evolution</span><span class="p">(</span><span class="n">exewrap</span><span class="p">,</span> <span class="n">bounds</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">x</span>
<span class="go">array([-7.32336275e-09,  6.00261842e-09])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">fun</span>
<span class="go">0.0</span>
</pre></div>
</div>
<p>If one wants to fix the second parameter during optimisation, for example
because the parameter is insensitive or one knows the parameter very well,
then this parameter can be excluded from the optimisation by using
<cite>exe_mask_wrapper</cite>, setting the mask to <em>False</em>, and providing <em>initial</em>
values of the parameters.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">partialwrap</span> <span class="kn">import</span> <span class="n">exe_mask_wrapper</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">exemwrap</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">exe_mask_wrapper</span><span class="p">,</span> <span class="n">exe</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span>
<span class="gp">... </span>                   <span class="n">parameterfile</span><span class="p">,</span> <span class="n">standard_parameter_writer</span><span class="p">,</span>
<span class="gp">... </span>                   <span class="n">outputfile</span><span class="p">,</span> <span class="n">standard_output_reader</span><span class="p">,</span> <span class="p">{})</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span> <span class="n">bb</span> <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">bb</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span> <span class="k">if</span> <span class="n">mask</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">differential_evolution</span><span class="p">(</span><span class="n">exemwrap</span><span class="p">,</span> <span class="n">bounds</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">x</span>
<span class="go">array([-7.32336275e-09])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">fun</span>
<span class="go">0.0</span>
</pre></div>
</div>
<p>The final output parameters are then:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">xout</span> <span class="o">=</span> <span class="n">x0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">xout</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">xout</span>
<span class="go">array([-7.32336275e-09,  0.00000000e+00])</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="partialwrap.wrappers.exe_wrapper">
<span class="sig-name descname"><span class="pre">exe_wrapper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parameterfile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parameterwriter</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outputfile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outputreader</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kwarg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/partialwrap/wrappers.html#exe_wrapper"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#partialwrap.wrappers.exe_wrapper" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrapper function for external programs using a <em>parameterwriter</em> and
<em>outputreader</em> with the interfaces:
<code class="docutils literal notranslate"><span class="pre">parameterwriter(parameterfile,</span> <span class="pre">x,</span> <span class="pre">*pargs,</span> <span class="pre">**pkwargs)</span></code>
and
<code class="docutils literal notranslate"><span class="pre">outputreader(outputfile,</span> <span class="pre">*oargs,</span> <span class="pre">**okwargs)</span></code>
or if <em>pid==True</em>:
<code class="docutils literal notranslate"><span class="pre">parameterwriter(parameterfile,</span> <span class="pre">x,</span> <span class="pre">*pargs,</span> <span class="pre">pid=pid,</span> <span class="pre">**pkwargs)</span></code>
and
<code class="docutils literal notranslate"><span class="pre">outputreader(outputfile,</span> <span class="pre">*oargs,</span> <span class="pre">pid=pid,</span> <span class="pre">**okwargs)</span></code></p>
<p>Examples of <em>parameterwriter</em> with <em>pid==True</em> are
<a class="reference internal" href="std_io.html#partialwrap.std_io.standard_parameter_writer" title="partialwrap.std_io.standard_parameter_writer"><code class="xref any py py-func docutils literal notranslate"><span class="pre">standard_parameter_writer</span></code></a> or <a class="reference internal" href="std_io.html#partialwrap.std_io.sub_params_ja" title="partialwrap.std_io.sub_params_ja"><code class="xref any py py-func docutils literal notranslate"><span class="pre">sub_params_ja</span></code></a>.
An example of <em>outputreader</em> with or without <em>pid</em> is
<a class="reference internal" href="std_io.html#partialwrap.std_io.standard_output_reader" title="partialwrap.std_io.standard_output_reader"><code class="xref any py py-func docutils literal notranslate"><span class="pre">standard_output_reader</span></code></a>.</p>
<p>To be used with <a class="reference external" href="https://docs.python.org/3/library/functools.html#functools.partial" title="(in Python v3.11)"><code class="xref any docutils literal notranslate"><span class="pre">functools.partial</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">obj</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">exe_wrapper</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span>
              <span class="n">parameterfile</span><span class="p">,</span> <span class="n">parameterwriter</span><span class="p">,</span>
              <span class="n">outputfile</span><span class="p">,</span> <span class="n">outputreader</span><span class="p">,</span>
              <span class="p">{</span><span class="s1">&#39;shell&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="s1">&#39;debug&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="s1">&#39;pid&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
               <span class="s1">&#39;pargs&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="s1">&#39;pkwargs&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
               <span class="s1">&#39;keepparameterfile&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
               <span class="s1">&#39;oargs&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="s1">&#39;okwargs&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
               <span class="s1">&#39;keepoutputfile&#39;</span><span class="p">:</span> <span class="nb">bool</span><span class="p">})</span>
</pre></div>
</div>
<p>This allows then calling <em>obj</em> simply with the parameters <em>x</em>:
<code class="docutils literal notranslate"><span class="pre">fx</span> <span class="pre">=</span> <span class="pre">obj(x)</span></code></p>
<p>which translates to:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">parameterwriter</span><span class="p">(</span><span class="n">parameterfile</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">pargs</span><span class="p">,</span> <span class="o">**</span><span class="n">pkwargs</span><span class="p">)</span>
<span class="n">err</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">outputreader</span><span class="p">(</span><span class="n">outputfile</span><span class="p">,</span> <span class="o">*</span><span class="n">oargs</span><span class="p">,</span> <span class="o">**</span><span class="n">okwargs</span><span class="p">)</span>
</pre></div>
</div>
<p>or if <em>pid==True</em> to:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">parameterwriter</span><span class="p">(</span><span class="n">parameterfile</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">pargs</span><span class="p">,</span> <span class="n">pid</span><span class="o">=</span><span class="n">pid</span><span class="p">,</span> <span class="o">**</span><span class="n">pkwargs</span><span class="p">)</span>
<span class="n">err</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">outputreader</span><span class="p">(</span><span class="n">outputfile</span><span class="p">,</span> <span class="o">*</span><span class="n">oargs</span><span class="p">,</span> <span class="n">pid</span><span class="o">=</span><span class="n">pid</span><span class="p">,</span> <span class="o">**</span><span class="n">okwargs</span><span class="p">)</span>
</pre></div>
</div>
<p>Note if <em>pid==True</em>, it is assumed that <em>parameterwriter</em> produces
files in the form <cite>parameterfile + ‘.’ + processid</cite>,
which will be removed after the function call.
Also files in the form <cite>outputfile + ‘.’ + processid</cite>
will be removed automatically.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func</strong> (<em>string</em><em> or </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.11)"><em>list</em></a><em> of </em><em>strings</em>) – External program to launch by <a class="reference external" href="https://docs.python.org/3/library/subprocess.html#module-subprocess" title="(in Python v3.11)"><code class="xref any docutils literal notranslate"><span class="pre">subprocess</span></code></a></p></li>
<li><p><strong>parameterfile</strong> (<em>string</em><em> or </em><em>iterable</em>) – Filename(s) of parameter file(s)</p></li>
<li><p><strong>parameterwriter</strong> (<em>callable</em>) – <p>Python function writing the <em>parameterfile</em>, called as:
<code class="docutils literal notranslate"><span class="pre">parameterwriter(parameterfile,</span> <span class="pre">x,</span> <span class="pre">*pargs,</span> <span class="pre">**pkwargs)</span></code></p>
<p>or if <em>pid==True</em> as:
<code class="docutils literal notranslate"><span class="pre">parameterwriter(parameterfile,</span> <span class="pre">x,</span> <span class="pre">*pargs,</span> <span class="pre">pid=pid,</span> <span class="pre">**pkwargs)</span></code></p>
</p></li>
<li><p><strong>outputfile</strong> (<em>string</em><em> or </em><em>iterable</em>) – Filename(s) of file(s) with output values written by the external
executable <em>func</em></p></li>
<li><p><strong>outputreader</strong> (<em>callable</em>) – <p>Python function for reading and processing output value(s) from
<em>outputfile</em>, called as:
<code class="docutils literal notranslate"><span class="pre">outputreader(ouputfile,</span> <span class="pre">x,</span> <span class="pre">*oargs,</span> <span class="pre">**okwargs)</span></code></p>
<p>or if <em>pid==True</em> as:
<code class="docutils literal notranslate"><span class="pre">outputreader(ouputfile,</span> <span class="pre">x,</span> <span class="pre">*oargs,</span> <span class="pre">pid=pid,</span> <span class="pre">**okwargs)</span></code></p>
</p></li>
<li><p><strong>kwarg</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.11)"><em>dict</em></a>) – <p>Dictionary with keyword arguments for <cite>exe_wrapper</cite>. Possible
arguments are:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">shell</span></code> (bool)
If True, <a class="reference external" href="https://docs.python.org/3/library/subprocess.html#module-subprocess" title="(in Python v3.11)"><code class="xref any docutils literal notranslate"><span class="pre">subprocess</span></code></a> opens shell for external executable</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">debug</span></code> (bool)
If True, model output is displayed while executable is running</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pid</span></code> (bool)
If True, append ‘.RandomNumber’ to <em>parameterfile</em> and
<em>outputfile</em> for parallel calls of <em>func</em></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pargs</span></code> (iterable)
List of arguments of <cite>parameterwriter</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pkwargs</span></code> (dict)
Dictionary with keyword arguments of <cite>parameterwriter</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">keepparameterfile</span></code> (bool)
If True, <cite>parameterfile</cite> produced with <cite>parameterwriter</cite> will
not be deleted after function call.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">oargs</span></code> (iterable)
List of arguments of <cite>outputreader</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">okwargs</span></code> (dict)
Dictionary with keyword arguments of <cite>outputreader</cite>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">keepoutputfile</span></code> (bool)
If True, <cite>outputfile</cite> produced by <cite>func</cite> will not be deleted
after function call.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">error</span></code> (function)
Function to call in case subprocess exists with error code &gt; 0. The
function should take one argument, which will be the random number if
<cite>pid=True</cite> or <em>None</em> otherwise. The return value will be used instead
of the result of <em>outputreader</em>.</p></li>
</ul>
</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Output value calculated by the external executable <em>func</em> or via
the <em>outputreader</em></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)">float</a></p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Imagine an external program <em>prog.exe</em> written in C or Fortan, for example,
that reads in two parameters from the file <em>params.txt</em> and writes its
results to a file <em>out.txt</em>. The parameters can be written with
<cite>standard_parameter_writer</cite> and read with <cite>standard_output_reader</cite>.</p>
<p>Then this external program can be wrapped as:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">partialwrap</span> <span class="kn">import</span> <span class="n">exe_wrapper</span><span class="p">,</span> <span class="n">standard_parameter_writer</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">partialwrap</span> <span class="kn">import</span> <span class="n">standard_output_reader</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">exe</span> <span class="o">=</span> <span class="s1">&#39;prog.exe&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">parameterfile</span> <span class="o">=</span> <span class="s1">&#39;params.txt&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">outputfile</span> <span class="o">=</span> <span class="s1">&#39;out.txt&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">exewrap</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">exe_wrapper</span><span class="p">,</span> <span class="n">exe</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="n">parameterfile</span><span class="p">,</span> <span class="n">standard_parameter_writer</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="n">outputfile</span><span class="p">,</span> <span class="n">standard_output_reader</span><span class="p">,</span> <span class="p">{})</span>
</pre></div>
</div>
<p>And is run as:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">exewrap</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
</pre></div>
</div>
<p><em>res</em> then holds the output of <em>prog.exe</em>.</p>
<p>Or one can find the minimum of the function in <em>prog.exe</em> with the global
optimizer Differential Evolution (assuming here that <em>prog.exe</em> calculates
the Rastrigin function).</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">scipy.optimize</span> <span class="k">as</span> <span class="nn">opt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="mf">5.12</span><span class="p">,</span> <span class="mf">5.12</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">differential_evolution</span><span class="p">(</span><span class="n">exewrap</span><span class="p">,</span> <span class="n">bounds</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">x</span>
<span class="go">array([-7.32336275e-09,  6.00261842e-09])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">fun</span>
<span class="go">0.0</span>
</pre></div>
</div>
<p>If <em>prog.exe</em> might fail with some parameter combinations from the
Differential Evolution algorithm, then one can give a fallback function for
this cases that, for example, returns arbitrary large values.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">err</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mf">10000.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">exewrap</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">exe_wrapper</span><span class="p">,</span> <span class="n">exe</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="n">parameterfile</span><span class="p">,</span> <span class="n">standard_parameter_writer</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="n">outputfile</span><span class="p">,</span> <span class="n">standard_output_reader</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="p">{</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="n">err</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">differential_evolution</span><span class="p">(</span><span class="n">exewrap</span><span class="p">,</span> <span class="n">bounds</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="partialwrap.wrappers.function_mask_wrapper">
<span class="sig-name descname"><span class="pre">function_mask_wrapper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">arg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kwarg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/partialwrap/wrappers.html#function_mask_wrapper"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#partialwrap.wrappers.function_mask_wrapper" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrapper function for Python function using a mask.</p>
<p>To be used with partial:
<code class="docutils literal notranslate"><span class="pre">obj</span> <span class="pre">=</span> <span class="pre">partial(function_mask_wrapper,</span> <span class="pre">func,</span> <span class="pre">x0,</span> <span class="pre">mask,</span> <span class="pre">arg,</span> <span class="pre">kwarg)</span></code></p>
<p>This allows then calling obj with only the non-masked parameters:
<code class="docutils literal notranslate"><span class="pre">fx</span> <span class="pre">=</span> <span class="pre">obj(x)</span></code></p>
<p>which translates to:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
<span class="n">xx</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
<span class="n">fx</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="o">**</span><span class="n">kwarg</span><span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func</strong> (<em>callable</em>) – Python function to be called <cite>func(x, *arg, **kwarg)</cite></p></li>
<li><p><strong>x0</strong> (<em>array_like</em>) – Fixed values of masked parameters</p></li>
<li><p><strong>mask</strong> (<em>array_like</em>) – Mask to use <em>x0</em> values (<cite>mask[i]=1</cite>) or use new parameters
<em>x</em> (<cite>ask[i]=0</cite>) in call of the function</p></li>
<li><p><strong>arg</strong> (<em>iterable</em>) – Arguments passed to <em>func</em></p></li>
<li><p><strong>kwarg</strong> (<em>dictionary</em>) – Keyword arguments passed to <em>func</em></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Output value calculated by <em>func</em></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)">float</a></p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Having the Python function <em>rastrigin</em> with the parameter <em>a</em> and
the keyword argument <em>b</em>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">rastrigin</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
<p>We want to evaluate the 5-dimensional rastrigin function at
<cite>[-1, 0, 1, 2, 3]</cite> using the parameters <cite>a=20.</cite>, <cite>b=np.pi</cite>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">partialwrap</span> <span class="kn">import</span> <span class="n">function_wrapper</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">args</span>   <span class="o">=</span> <span class="p">[</span><span class="mf">20.</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mf">1.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rastra</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">function_wrapper</span><span class="p">,</span> <span class="n">rastrigin</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">rastra</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span>
<span class="go">135.0</span>
</pre></div>
</div>
<p>Or we want find its minimum with the global optimizer Differential
Evolution, which allows passing arguments such as <cite>args=(20.)</cite> but does not
allow passing keyword arguments such <cite>b=np.pi</cite>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">scipy.optimize</span> <span class="k">as</span> <span class="nn">opt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="mf">5.12</span><span class="p">,</span> <span class="mf">5.12</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">differential_evolution</span><span class="p">(</span><span class="n">rastra</span><span class="p">,</span> <span class="n">bounds</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">x</span>
<span class="go">array([-7.32336275e-09,  6.00261842e-09,  1.26476721e-09, -1.61965090e-10,</span>
<span class="go">       -7.35012009e-09])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">fun</span>
<span class="go">0.0</span>
</pre></div>
</div>
<p>If one wants to fix the second parameter during optimisation, for example
because the parameter is insensitive or one knows the parameter very well
(very hypothetical in the example of rastrigin), then this parameter can be
excluded from the optimisation by using <cite>function_mask_wrapper</cite>, setting
the mask to <em>False</em>, and providing <em>initial</em> values of the parameters.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">partialwrap</span> <span class="kn">import</span> <span class="n">function_mask_wrapper</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rastram</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">function_mask_wrapper</span><span class="p">,</span> <span class="n">rastrigin</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span>
<span class="gp">... </span>                  <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span> <span class="n">bb</span> <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">bb</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span> <span class="k">if</span> <span class="n">mask</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">differential_evolution</span><span class="p">(</span><span class="n">rastram</span><span class="p">,</span> <span class="n">bounds</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">x</span>
<span class="go">array([-7.32336275e-09,  1.26476721e-09, -1.61965090e-10, -7.35012009e-09])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">fun</span>
<span class="go">0.0</span>
</pre></div>
</div>
<p>The final output parameters are then:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">xout</span> <span class="o">=</span> <span class="n">x0</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">xout</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">xout</span>
<span class="go">array([-7.32336275e-09,  0.00000000e+00,  1.26476721e-09, -1.61965090e-10,</span>
<span class="go">       -7.35012009e-09])</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="partialwrap.wrappers.function_wrapper">
<span class="sig-name descname"><span class="pre">function_wrapper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">func</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">arg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kwarg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/partialwrap/wrappers.html#function_wrapper"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#partialwrap.wrappers.function_wrapper" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrapper for Python functions.</p>
<p>To be used with partial:
<code class="docutils literal notranslate"><span class="pre">obj</span> <span class="pre">=</span> <span class="pre">partial(function_wrapper,</span> <span class="pre">func,</span> <span class="pre">arg,</span> <span class="pre">kwarg)</span></code></p>
<p>This allows then calling obj with only the non-masked parameters:
<code class="docutils literal notranslate"><span class="pre">fx</span> <span class="pre">=</span> <span class="pre">obj(x)</span></code></p>
<p>which translates to:
<code class="docutils literal notranslate"><span class="pre">fx</span> <span class="pre">=</span> <span class="pre">func(x,</span> <span class="pre">*arg,</span> <span class="pre">**kwarg)</span></code></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>func</strong> (<em>callable</em>) – Python function to be called <cite>func(x, *arg, **kwarg)</cite></p></li>
<li><p><strong>arg</strong> (<em>iterable</em>) – Arguments passed to <em>func</em></p></li>
<li><p><strong>kwarg</strong> (<em>dictionary</em>) – Keyword arguments passed to <em>func</em></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Output value calculated by <em>func</em></p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.11)">float</a></p>
</dd>
</dl>
<p class="rubric">Examples</p>
<p>Having the Python function <em>rastrigin</em> with the parameter <em>a</em> and
the keyword argument <em>b</em>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">rastrigin</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
<p>We want to evaluate the 5-dimensional rastrigin function at
<cite>[-1, 0, 1, 2, 3]</cite> using the parameters <cite>a=20.</cite>, <cite>b=np.pi</cite>:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">partialwrap</span> <span class="kn">import</span> <span class="n">function_wrapper</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">args</span>   <span class="o">=</span> <span class="p">[</span><span class="mf">20.</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mf">1.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">rastra</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">function_wrapper</span><span class="p">,</span> <span class="n">rastrigin</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">rastra</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span>
<span class="go">135.0</span>
</pre></div>
</div>
<p>Or find its minimum with the global optimizer Differential Evolution,
which allows passing arguments such as <cite>args=(20.)</cite> but does not allow
passing keyword arguments such <cite>b=np.pi</cite>.</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">scipy.optimize</span> <span class="k">as</span> <span class="nn">opt</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="mf">5.12</span><span class="p">,</span> <span class="mf">5.12</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">differential_evolution</span><span class="p">(</span><span class="n">rastra</span><span class="p">,</span> <span class="n">bounds</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">x</span>
<span class="go">array([-7.32336275e-09,  6.00261842e-09,  1.26476721e-09, -1.61965090e-10,</span>
<span class="go">       -7.35012009e-09])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span><span class="o">.</span><span class="n">fun</span>
<span class="go">0.0</span>
</pre></div>
</div>
</dd></dl>

</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="contents.html">partialwrap</a></h1>



<p class="blurb">Wrappers of external executables and Python functions for functools.partial.</p>






<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#quick-usage-guide">Quick usage guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#requirements">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#license">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#indices-and-tables">Indices and tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="userguide.html">User Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="api.html">Public API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="api.html#purpose">Purpose</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html#subpackages">Subpackages</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">partialwrap.wrappers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#partialwrap.wrappers.exe_mask_wrapper"><code class="docutils literal notranslate"><span class="pre">exe_mask_wrapper()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#partialwrap.wrappers.exe_wrapper"><code class="docutils literal notranslate"><span class="pre">exe_wrapper()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#partialwrap.wrappers.function_mask_wrapper"><code class="docutils literal notranslate"><span class="pre">function_mask_wrapper()</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#partialwrap.wrappers.function_wrapper"><code class="docutils literal notranslate"><span class="pre">function_wrapper()</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="std_io.html">partialwrap.std_io</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Authors</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="https://github.com/mcuntz/partialwrap">partialwrap @ GitHub</a></li>
    
    <li class="toctree-l1"><a href="https://doi.org/10.5281/zenodo.3893705">partialwrap @ Zenodo</a></li>
    
    <li class="toctree-l1"><a href="https://pypi.org/project/partialwrap">partialwrap @ PyPI</a></li>
    
    <li class="toctree-l1"><a href="https://anaconda.org/conda-forge/partialwrap">partialwrap @ conda-forge</a></li>
    
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="contents.html">Documentation overview</a><ul>
  <li><a href="api.html">Public API</a><ul>
      <li>Previous: <a href="api.html" title="previous chapter">Public API</a></li>
      <li>Next: <a href="std_io.html" title="next chapter">partialwrap.std_io</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016-2023, Matthias Cuntz.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="_sources/wrappers.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>